[
  {
    "objectID": "assignment04-juliocesarvg.html",
    "href": "assignment04-juliocesarvg.html",
    "title": "Assignment 04",
    "section": "",
    "text": "from pyspark.sql import SparkSession\nimport pandas as pd\nimport plotly.express as px\nimport plotly.io as pio\nimport numpy as np\n\nnp.random.seed(42)\n\npio.renderers.default = \"notebook+notebook_connected+vscode\"\n\n# Initialize Spark Session\nspark = SparkSession.builder.appName(\"LightcastData\").getOrCreate()\n\n# Load Data\ndf = spark.read.option(\"header\", \"true\").option(\"inferSchema\", \"true\").option(\"multiLine\",\"true\").option(\"escape\", \"\\\"\").csv(\"data/lightcast_job_postings.csv\")\n\n# Show Schema and Sample Data\nprint(\"---This is Diagnostic check, No need to print it in the final doc---\")\n\n# df.printSchema() # comment this line when rendering the submission\ndf.show(5)\nprint(df.count())\n#pd.set_option(\"display.max_rows\", None)  \n#pd.DataFrame(df.columns, columns=[\"Column Names\"])\n\n[Stage 1:&gt;                                                          (0 + 1) / 1]                                                                                \n\n\n---This is Diagnostic check, No need to print it in the final doc---\n\n\n25/10/07 07:29:28 WARN SparkStringUtils: Truncated the string representation of a plan since it was too large. This behavior can be adjusted by setting 'spark.sql.debug.maxToStringFields'.\n[Stage 2:&gt;                                                          (0 + 1) / 1]                                                                                \n\n\n+--------------------+-----------------+----------------------+----------+--------+---------+--------+--------------------+--------------------+--------------------+-----------+-------------------+--------------------+--------------------+---------------+----------------+--------+--------------------+-----------+-------------------+----------------+---------------------+-------------+-------------------+-------------+------------------+---------------+--------------------+--------------------+--------------------+-------------+------+-----------+----------------+-------------------+---------+-----------+--------------------+--------------------+-------------+------+--------------+-----+--------------------+-----+----------+---------------+--------------------+---------------+--------------------+------------+--------------------+------------+--------------------+------+--------------------+------+--------------------+------+--------------------+------+--------------------+------+--------------------+------------------+-------------------+--------------------+--------------------+--------------------+--------------------+-----------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+----------+--------------------+----------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+----------+--------------------+----------+--------------------+----------+---------------+----------+---------------+---------------+--------------------+--------------+--------------------+--------------------------+-------------------------------+--------------------+-------------------------+-----------------------------+----------------------------------+-----------------+----------------------+-----------------------+----------------------------+------------------+-----------------------+-------+--------------------+-------+--------------------+-------+---------------+-------+---------------+-----------------+----------------------+------------+--------------------+------------+--------------------+------------+--------------------+------------+--------------------+------------+--------------------+\n|                  ID|LAST_UPDATED_DATE|LAST_UPDATED_TIMESTAMP|DUPLICATES|  POSTED|  EXPIRED|DURATION|        SOURCE_TYPES|             SOURCES|                 URL|ACTIVE_URLS|ACTIVE_SOURCES_INFO|           TITLE_RAW|                BODY|MODELED_EXPIRED|MODELED_DURATION| COMPANY|        COMPANY_NAME|COMPANY_RAW|COMPANY_IS_STAFFING|EDUCATION_LEVELS|EDUCATION_LEVELS_NAME|MIN_EDULEVELS| MIN_EDULEVELS_NAME|MAX_EDULEVELS|MAX_EDULEVELS_NAME|EMPLOYMENT_TYPE|EMPLOYMENT_TYPE_NAME|MIN_YEARS_EXPERIENCE|MAX_YEARS_EXPERIENCE|IS_INTERNSHIP|SALARY|REMOTE_TYPE|REMOTE_TYPE_NAME|ORIGINAL_PAY_PERIOD|SALARY_TO|SALARY_FROM|            LOCATION|                CITY|    CITY_NAME|COUNTY|   COUNTY_NAME|  MSA|            MSA_NAME|STATE|STATE_NAME|COUNTY_OUTGOING|COUNTY_NAME_OUTGOING|COUNTY_INCOMING|COUNTY_NAME_INCOMING|MSA_OUTGOING|   MSA_NAME_OUTGOING|MSA_INCOMING|   MSA_NAME_INCOMING|NAICS2|         NAICS2_NAME|NAICS3|         NAICS3_NAME|NAICS4|         NAICS4_NAME|NAICS5|         NAICS5_NAME|NAICS6|         NAICS6_NAME|             TITLE|         TITLE_NAME|         TITLE_CLEAN|              SKILLS|         SKILLS_NAME|  SPECIALIZED_SKILLS|SPECIALIZED_SKILLS_NAME|      CERTIFICATIONS| CERTIFICATIONS_NAME|       COMMON_SKILLS|  COMMON_SKILLS_NAME|     SOFTWARE_SKILLS|SOFTWARE_SKILLS_NAME|      ONET|           ONET_NAME| ONET_2019|      ONET_2019_NAME|                CIP6|           CIP6_NAME|                CIP4|           CIP4_NAME|                CIP2|           CIP2_NAME|SOC_2021_2|     SOC_2021_2_NAME|SOC_2021_3|     SOC_2021_3_NAME|SOC_2021_4|SOC_2021_4_NAME|SOC_2021_5|SOC_2021_5_NAME|LOT_CAREER_AREA|LOT_CAREER_AREA_NAME|LOT_OCCUPATION| LOT_OCCUPATION_NAME|LOT_SPECIALIZED_OCCUPATION|LOT_SPECIALIZED_OCCUPATION_NAME|LOT_OCCUPATION_GROUP|LOT_OCCUPATION_GROUP_NAME|LOT_V6_SPECIALIZED_OCCUPATION|LOT_V6_SPECIALIZED_OCCUPATION_NAME|LOT_V6_OCCUPATION|LOT_V6_OCCUPATION_NAME|LOT_V6_OCCUPATION_GROUP|LOT_V6_OCCUPATION_GROUP_NAME|LOT_V6_CAREER_AREA|LOT_V6_CAREER_AREA_NAME|  SOC_2|          SOC_2_NAME|  SOC_3|          SOC_3_NAME|  SOC_4|     SOC_4_NAME|  SOC_5|     SOC_5_NAME|LIGHTCAST_SECTORS|LIGHTCAST_SECTORS_NAME|NAICS_2022_2|   NAICS_2022_2_NAME|NAICS_2022_3|   NAICS_2022_3_NAME|NAICS_2022_4|   NAICS_2022_4_NAME|NAICS_2022_5|   NAICS_2022_5_NAME|NAICS_2022_6|   NAICS_2022_6_NAME|\n+--------------------+-----------------+----------------------+----------+--------+---------+--------+--------------------+--------------------+--------------------+-----------+-------------------+--------------------+--------------------+---------------+----------------+--------+--------------------+-----------+-------------------+----------------+---------------------+-------------+-------------------+-------------+------------------+---------------+--------------------+--------------------+--------------------+-------------+------+-----------+----------------+-------------------+---------+-----------+--------------------+--------------------+-------------+------+--------------+-----+--------------------+-----+----------+---------------+--------------------+---------------+--------------------+------------+--------------------+------------+--------------------+------+--------------------+------+--------------------+------+--------------------+------+--------------------+------+--------------------+------------------+-------------------+--------------------+--------------------+--------------------+--------------------+-----------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+----------+--------------------+----------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+----------+--------------------+----------+--------------------+----------+---------------+----------+---------------+---------------+--------------------+--------------+--------------------+--------------------------+-------------------------------+--------------------+-------------------------+-----------------------------+----------------------------------+-----------------+----------------------+-----------------------+----------------------------+------------------+-----------------------+-------+--------------------+-------+--------------------+-------+---------------+-------+---------------+-----------------+----------------------+------------+--------------------+------------+--------------------+------------+--------------------+------------+--------------------+------------+--------------------+\n|1f57d95acf4dc67ed...|         9/6/2024|  2024-09-06 20:32:...|         0|6/2/2024| 6/8/2024|       6|   [\\n  \"Company\"\\n]|[\\n  \"brassring.c...|[\\n  \"https://sjo...|         []|               NULL|Enterprise Analys...|31-May-2024\\n\\nEn...|       6/8/2024|               6|  894731|          Murphy USA| Murphy USA|              false|       [\\n  2\\n]| [\\n  \"Bachelor's ...|            2|  Bachelor's degree|         NULL|              NULL|              1|Full-time (&gt; 32 h...|                   2|                   2|        false|  NULL|          0|          [None]|               NULL|     NULL|       NULL|{\\n  \"lat\": 33.20...|RWwgRG9yYWRvLCBBUg==|El Dorado, AR|  5139|     Union, AR|20980|       El Dorado, AR|    5|  Arkansas|           5139|           Union, AR|           5139|           Union, AR|       20980|       El Dorado, AR|       20980|       El Dorado, AR|    44|        Retail Trade|   441|Motor Vehicle and...|  4413|Automotive Parts,...| 44133|Automotive Parts ...|441330|Automotive Parts ...|ET29C073C03D1F86B4|Enterprise Analysts|enterprise analys...|[\\n  \"KS126DB6T06...|[\\n  \"Merchandisi...|[\\n  \"KS126DB6T06...|   [\\n  \"Merchandisi...|                  []|                  []|[\\n  \"KS126706DPF...|[\\n  \"Mathematics...|[\\n  \"KS440W865GC...|[\\n  \"SQL (Progra...|15-2051.01|Business Intellig...|15-2051.01|Business Intellig...|[\\n  \"45.0601\",\\n...|[\\n  \"Economics, ...|[\\n  \"45.06\",\\n  ...|[\\n  \"Economics\",...|[\\n  \"45\",\\n  \"27...|[\\n  \"Social Scie...|   15-0000|Computer and Math...|   15-2000|Mathematical Scie...|   15-2050|Data Scientists|   15-2051|Data Scientists|             23|Information Techn...|        231010|Business Intellig...|                  23101011|           General ERP Analy...|                2310|     Business Intellig...|                     23101011|              General ERP Analy...|           231010|  Business Intellig...|                   2310|        Business Intellig...|                23|   Information Techn...|15-0000|Computer and Math...|15-2000|Mathematical Scie...|15-2050|Data Scientists|15-2051|Data Scientists|        [\\n  7\\n]|  [\\n  \"Artificial ...|          44|        Retail Trade|         441|Motor Vehicle and...|        4413|Automotive Parts,...|       44133|Automotive Parts ...|      441330|Automotive Parts ...|\n|0cb072af26757b6c4...|         8/2/2024|  2024-08-02 17:08:...|         0|6/2/2024| 8/1/2024|    NULL| [\\n  \"Job Board\"\\n]| [\\n  \"maine.gov\"\\n]|[\\n  \"https://job...|         []|               NULL|Oracle Consultant...|Oracle Consultant...|       8/1/2024|            NULL|  133098|Smx Corporation L...|        SMX|               true|      [\\n  99\\n]| [\\n  \"No Educatio...|           99|No Education Listed|         NULL|              NULL|              1|Full-time (&gt; 32 h...|                   3|                   3|        false|  NULL|          1|          Remote|               NULL|     NULL|       NULL|{\\n  \"lat\": 44.31...|    QXVndXN0YSwgTUU=|  Augusta, ME| 23011|  Kennebec, ME|12300|Augusta-Watervill...|   23|     Maine|          23011|        Kennebec, ME|          23011|        Kennebec, ME|       12300|Augusta-Watervill...|       12300|Augusta-Watervill...|    56|Administrative an...|   561|Administrative an...|  5613| Employment Services| 56132|Temporary Help Se...|561320|Temporary Help Se...|ET21DDA63780A7DC09| Oracle Consultants|oracle consultant...|[\\n  \"KS122626T55...|[\\n  \"Procurement...|[\\n  \"KS122626T55...|   [\\n  \"Procurement...|                  []|                  []|                  []|                  []|[\\n  \"BGSBF3F508F...|[\\n  \"Oracle Busi...|15-2051.01|Business Intellig...|15-2051.01|Business Intellig...|                  []|                  []|                  []|                  []|                  []|                  []|   15-0000|Computer and Math...|   15-2000|Mathematical Scie...|   15-2050|Data Scientists|   15-2051|Data Scientists|             23|Information Techn...|        231010|Business Intellig...|                  23101012|           Oracle Consultant...|                2310|     Business Intellig...|                     23101012|              Oracle Consultant...|           231010|  Business Intellig...|                   2310|        Business Intellig...|                23|   Information Techn...|15-0000|Computer and Math...|15-2000|Mathematical Scie...|15-2050|Data Scientists|15-2051|Data Scientists|             NULL|                  NULL|          56|Administrative an...|         561|Administrative an...|        5613| Employment Services|       56132|Temporary Help Se...|      561320|Temporary Help Se...|\n|85318b12b3331fa49...|         9/6/2024|  2024-09-06 20:32:...|         1|6/2/2024| 7/7/2024|      35| [\\n  \"Job Board\"\\n]|[\\n  \"dejobs.org\"\\n]|[\\n  \"https://dej...|         []|               NULL|        Data Analyst|Taking care of pe...|      6/10/2024|               8|39063746|            Sedgwick|   Sedgwick|              false|       [\\n  2\\n]| [\\n  \"Bachelor's ...|            2|  Bachelor's degree|         NULL|              NULL|              1|Full-time (&gt; 32 h...|                   5|                NULL|        false|  NULL|          0|          [None]|               NULL|     NULL|       NULL|{\\n  \"lat\": 32.77...|    RGFsbGFzLCBUWA==|   Dallas, TX| 48113|    Dallas, TX|19100|Dallas-Fort Worth...|   48|     Texas|          48113|          Dallas, TX|          48113|          Dallas, TX|       19100|Dallas-Fort Worth...|       19100|Dallas-Fort Worth...|    52|Finance and Insur...|   524|Insurance Carrier...|  5242|Agencies, Brokera...| 52429|Other Insurance R...|524291|    Claims Adjusting|ET3037E0C947A02404|      Data Analysts|        data analyst|[\\n  \"KS1218W78FG...|[\\n  \"Management\"...|[\\n  \"ESF3939CE1F...|   [\\n  \"Exception R...|[\\n  \"KS683TN76T7...|[\\n  \"Security Cl...|[\\n  \"KS1218W78FG...|[\\n  \"Management\"...|[\\n  \"KS126HY6YLT...|[\\n  \"Microsoft O...|15-2051.01|Business Intellig...|15-2051.01|Business Intellig...|                  []|                  []|                  []|                  []|                  []|                  []|   15-0000|Computer and Math...|   15-2000|Mathematical Scie...|   15-2050|Data Scientists|   15-2051|Data Scientists|             23|Information Techn...|        231113|Data / Data Minin...|                  23111310|                   Data Analyst|                2311|     Data Analysis and...|                     23111310|                      Data Analyst|           231113|  Data / Data Minin...|                   2311|        Data Analysis and...|                23|   Information Techn...|15-0000|Computer and Math...|15-2000|Mathematical Scie...|15-2050|Data Scientists|15-2051|Data Scientists|             NULL|                  NULL|          52|Finance and Insur...|         524|Insurance Carrier...|        5242|Agencies, Brokera...|       52429|Other Insurance R...|      524291|    Claims Adjusting|\n|1b5c3941e54a1889e...|         9/6/2024|  2024-09-06 20:32:...|         1|6/2/2024|7/20/2024|      48| [\\n  \"Job Board\"\\n]|[\\n  \"disabledper...|[\\n  \"https://www...|         []|               NULL|Sr. Lead Data Mgm...|About this role:\\...|      6/12/2024|              10|37615159|         Wells Fargo|Wells Fargo|              false|      [\\n  99\\n]| [\\n  \"No Educatio...|           99|No Education Listed|         NULL|              NULL|              1|Full-time (&gt; 32 h...|                   3|                NULL|        false|  NULL|          0|          [None]|               NULL|     NULL|       NULL|{\\n  \"lat\": 33.44...|    UGhvZW5peCwgQVo=|  Phoenix, AZ|  4013|  Maricopa, AZ|38060|Phoenix-Mesa-Chan...|    4|   Arizona|           4013|        Maricopa, AZ|           4013|        Maricopa, AZ|       38060|Phoenix-Mesa-Chan...|       38060|Phoenix-Mesa-Chan...|    52|Finance and Insur...|   522|Credit Intermedia...|  5221|Depository Credit...| 52211|  Commercial Banking|522110|  Commercial Banking|ET2114E0404BA30075|Management Analysts|sr lead data mgmt...|[\\n  \"KS123QX62QY...|[\\n  \"Exit Strate...|[\\n  \"KS123QX62QY...|   [\\n  \"Exit Strate...|                  []|                  []|[\\n  \"KS7G6NP6R6L...|[\\n  \"Reliability...|[\\n  \"KS4409D76NW...|[\\n  \"SAS (Softwa...|15-2051.01|Business Intellig...|15-2051.01|Business Intellig...|                  []|                  []|                  []|                  []|                  []|                  []|   15-0000|Computer and Math...|   15-2000|Mathematical Scie...|   15-2050|Data Scientists|   15-2051|Data Scientists|             23|Information Techn...|        231113|Data / Data Minin...|                  23111310|                   Data Analyst|                2311|     Data Analysis and...|                     23111310|                      Data Analyst|           231113|  Data / Data Minin...|                   2311|        Data Analysis and...|                23|   Information Techn...|15-0000|Computer and Math...|15-2000|Mathematical Scie...|15-2050|Data Scientists|15-2051|Data Scientists|        [\\n  6\\n]|  [\\n  \"Data Privac...|          52|Finance and Insur...|         522|Credit Intermedia...|        5221|Depository Credit...|       52211|  Commercial Banking|      522110|  Commercial Banking|\n|cb5ca25f02bdf25c1...|        6/19/2024|   2024-06-19 07:00:00|         0|6/2/2024|6/17/2024|      15|[\\n  \"FreeJobBoar...|[\\n  \"craigslist....|[\\n  \"https://mod...|         []|               NULL|Comisiones de $10...|Comisiones de $10...|      6/17/2024|              15|       0|        Unclassified|      LH/GM|              false|      [\\n  99\\n]| [\\n  \"No Educatio...|           99|No Education Listed|         NULL|              NULL|              3|Part-time / full-...|                NULL|                NULL|        false| 92500|          0|          [None]|               year|   150000|      35000|{\\n  \"lat\": 37.63...|    TW9kZXN0bywgQ0E=|  Modesto, CA|  6099|Stanislaus, CA|33700|         Modesto, CA|    6|California|           6099|      Stanislaus, CA|           6099|      Stanislaus, CA|       33700|         Modesto, CA|       33700|         Modesto, CA|    99|Unclassified Indu...|   999|Unclassified Indu...|  9999|Unclassified Indu...| 99999|Unclassified Indu...|999999|Unclassified Indu...|ET0000000000000000|       Unclassified|comisiones de por...|                  []|                  []|                  []|                     []|                  []|                  []|                  []|                  []|                  []|                  []|15-2051.01|Business Intellig...|15-2051.01|Business Intellig...|                  []|                  []|                  []|                  []|                  []|                  []|   15-0000|Computer and Math...|   15-2000|Mathematical Scie...|   15-2050|Data Scientists|   15-2051|Data Scientists|             23|Information Techn...|        231010|Business Intellig...|                  23101012|           Oracle Consultant...|                2310|     Business Intellig...|                     23101012|              Oracle Consultant...|           231010|  Business Intellig...|                   2310|        Business Intellig...|                23|   Information Techn...|15-0000|Computer and Math...|15-2000|Mathematical Scie...|15-2050|Data Scientists|15-2051|Data Scientists|             NULL|                  NULL|          99|Unclassified Indu...|         999|Unclassified Indu...|        9999|Unclassified Indu...|       99999|Unclassified Indu...|      999999|Unclassified Indu...|\n+--------------------+-----------------+----------------------+----------+--------+---------+--------+--------------------+--------------------+--------------------+-----------+-------------------+--------------------+--------------------+---------------+----------------+--------+--------------------+-----------+-------------------+----------------+---------------------+-------------+-------------------+-------------+------------------+---------------+--------------------+--------------------+--------------------+-------------+------+-----------+----------------+-------------------+---------+-----------+--------------------+--------------------+-------------+------+--------------+-----+--------------------+-----+----------+---------------+--------------------+---------------+--------------------+------------+--------------------+------------+--------------------+------+--------------------+------+--------------------+------+--------------------+------+--------------------+------+--------------------+------------------+-------------------+--------------------+--------------------+--------------------+--------------------+-----------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+----------+--------------------+----------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+--------------------+----------+--------------------+----------+--------------------+----------+---------------+----------+---------------+---------------+--------------------+--------------+--------------------+--------------------------+-------------------------------+--------------------+-------------------------+-----------------------------+----------------------------------+-----------------+----------------------+-----------------------+----------------------------+------------------+-----------------------+-------+--------------------+-------+--------------------+-------+---------------+-------+---------------+-----------------+----------------------+------------+--------------------+------------+--------------------+------------+--------------------+------------+--------------------+------------+--------------------+\nonly showing top 5 rows\n\n\n[Stage 3:&gt;                                                          (0 + 1) / 1]\n\n\n72498\n\n\n                                                                                \n\n\nFeature Engineering is a crucial step in preparing your data for machine learning. In this lab, we will focus on the following tasks:\n\nDrop rows with missing values in the target variable and key features.\nBy now you are already familiar with the code and the data. Based on your understanding please choose any 3 (my code output has 10) variables as:\n\nthree continuous variables and, MIN_YEARS_EXPERIENCE (total 4, use your best judgment!)\ntwo categorical.\nYour dependent variable (y) is SALARY.\n\nConvert categorical variables into numerical representations using StringIndexer and OneHotEncoder.\nAssemble features into a single vector using VectorAssembler.\nSplit the data into training and testing sets.\nYou can use pipeline to do the above steps in one go.\nCreate a new column MIN_YEARS_EXPERIENCE_SQ by squaring the MIN_YEARS_EXPERIENCE column.\nAssemble the polynomial features into a new vector column features_poly using VectorAssembler.\nShow the final structure of the DataFrame with the new features.\n\n\n\n+------+--------------------+--------------------+--------+-------------------+-------------+----------+----------------+----------------------+-------------------+------------------+\n|SALARY|MIN_YEARS_EXPERIENCE|MAX_YEARS_EXPERIENCE|DURATION|COMPANY_IS_STAFFING|IS_INTERNSHIP|STATE_NAME|REMOTE_TYPE_NAME|EMPLOYMENT_TYPE_NAME  |MIN_EDULEVELS_NAME |MAX_EDULEVELS_NAME|\n+------+--------------------+--------------------+--------+-------------------+-------------+----------+----------------+----------------------+-------------------+------------------+\n|NULL  |2                   |2                   |6       |false              |false        |Arkansas  |[None]          |Full-time (&gt; 32 hours)|Bachelor's degree  |NULL              |\n|NULL  |3                   |3                   |NULL    |true               |false        |Maine     |Remote          |Full-time (&gt; 32 hours)|No Education Listed|NULL              |\n|NULL  |5                   |NULL                |35      |false              |false        |Texas     |[None]          |Full-time (&gt; 32 hours)|Bachelor's degree  |NULL              |\n|NULL  |3                   |NULL                |48      |false              |false        |Arizona   |[None]          |Full-time (&gt; 32 hours)|No Education Listed|NULL              |\n|92500 |NULL                |NULL                |15      |false              |false        |California|[None]          |Part-time / full-time |No Education Listed|NULL              |\n+------+--------------------+--------------------+--------+-------------------+-------------+----------+----------------+----------------------+-------------------+------------------+\nonly showing top 5 rows\n\n\n\nfrom pyspark.sql.functions import col, sum as spark_sum, when, trim, length\nimport hvplot.pandas  # enables hvplot on pandas\n\nmissing_df = df_eda.select([\n    spark_sum(\n        when(col(c).isNull() | (length(trim(col(c))) == 0), 1)\n        .otherwise(0)\n    ).alias(c)\n    for c in df_eda.columns\n])\n\n#print(missing_df.show())\n\n#to table with T Transpose\nmissing_pd = missing_df.toPandas().T.reset_index()\n#put names to columns\nmissing_pd.columns = [\"column\", \"missing_count\"]\n\ntotal_rows = df_eda.count()\nmissing_pd[\"missing_pct\"] = 100 * missing_pd[\"missing_count\"] / total_rows\n\n# hvplot.bar ; line; scatter; (hist); (box); area; (heatmap); (hexbin); points\nmissing_pd.sort_values(\"missing_pct\", ascending=False).hvplot.bar(\n    x=\"column\", y=\"missing_pct\", rot=90,\n    title=\"Percentage of Missing Values by Column\",\n    height=600, width=900,\n    ylabel=\"Missing Percentage (%)\", xlabel=\"Features\"\n).opts(xrotation=45)\n\n\n\n\n\n\n\n\n\n\n\n  \n\n\n\n\n[Stage 7:&gt;                                                          (0 + 1) / 1]                                                                                [Stage 10:&gt;                                                         (0 + 1) / 1]                                                                                \n\n\n\n\n\n\n  \n\n\n\n\n\n# For REMOTE_TYPE_NAME replace Remote with Remote, [None] with Undefined,\n# Not Remote with On Premise, Hybrid Remote with Hybrid, and Null with On Premise\n## data frame (eda) exploratory data analysis\n\ndf_eda = df_eda.withColumn(\n    \"REMOTE_TYPE_NAME\",\n    when(col(\"REMOTE_TYPE_NAME\") == \"Remote\", \"Remote\")\n    .when(col(\"REMOTE_TYPE_NAME\") == \"[None]\", \"Undefined\")\n    .when(col(\"REMOTE_TYPE_NAME\") == \"Not Remote\", \"On-Premise\")\n    .when(col(\"REMOTE_TYPE_NAME\") == \"Hybrid Remote\", \"Hybrid\")\n    .when(col(\"REMOTE_TYPE_NAME\").isNull(), \"On-Premise\")\n    .otherwise(col(\"REMOTE_TYPE_NAME\"))\n)\n\n# df_eda.createOrReplaceTempView(\"df_eda\")\ncategorical_cols = [\n    \"REMOTE_TYPE_NAME\"\n]\n\nfor colname in categorical_cols:\n    print(f\"\\n---- {colname} ----\")\n    df_eda.select(colname).distinct().show(10, truncate=False)\n\n\n---- REMOTE_TYPE_NAME ----\n\n\n[Stage 13:&gt;                                                         (0 + 1) / 1]\n\n\n+----------------+\n|REMOTE_TYPE_NAME|\n+----------------+\n|Remote          |\n|On-Premise      |\n|Hybrid          |\n|Undefined       |\n+----------------+\n\n\n\n                                                                                \n\n\n\n# ---- EMPLOYMENT_TYPE_NAME ----\n                                                                                \n# +------------------------+\n# |EMPLOYMENT_TYPE_NAME    |\n# +------------------------+\n# |Part-time / full-time   |\n# |Part-time (â‰¤ 32 hours)|\n# |Full-time (&gt; 32 hours)  |\n# |NULL                    |\n# +------------------------+\n\ndf_eda = df_eda.withColumn(\n    \"EMPLOYMENT_TYPE_NAME\",\n    when(col(\"EMPLOYMENT_TYPE_NAME\") == \"Part-time / full-time\", \"Flexible\")\n    .when(col(\"EMPLOYMENT_TYPE_NAME\") == \"Part-time (â‰¤ 32 hours)\", \"Parttime\")\n    .when(col(\"EMPLOYMENT_TYPE_NAME\") == \"Full-time (&gt; 32 hours)\", \"Fulltime\")\n    .when(col(\"EMPLOYMENT_TYPE_NAME\").isNull(), \"Fulltime\")\n    .otherwise(col(\"EMPLOYMENT_TYPE_NAME\"))\n)\n\n# df_eda.createOrReplaceTempView(\"df_eda\")\ncategorical_cols = [\n    \"EMPLOYMENT_TYPE_NAME\"\n]\n\nfor colname in categorical_cols:\n    print(f\"\\n---- {colname} ----\")\n    df_eda.select(colname).distinct().show(10, truncate=False)\n\n\n---- EMPLOYMENT_TYPE_NAME ----\n\n\n[Stage 16:&gt;                                                         (0 + 1) / 1]\n\n\n+--------------------+\n|EMPLOYMENT_TYPE_NAME|\n+--------------------+\n|Flexible            |\n|Fulltime            |\n|Parttime            |\n+--------------------+\n\n\n\n                                                                                \n\n\n\n# replace COMPANY_IS_STAFFING NULL with false, and IS_INTERNSHIP NULL with false\ndf_eda = df_eda.withColumn(\n    \"COMPANY_IS_STAFFING\",\n    when(col(\"COMPANY_IS_STAFFING\").isNull(), False)\n    .otherwise(col(\"COMPANY_IS_STAFFING\"))\n)\n\ndf_eda = df_eda.withColumn(\n    \"IS_INTERNSHIP\",\n    when(col(\"IS_INTERNSHIP\").isNull(), False)\n    .otherwise(col(\"IS_INTERNSHIP\"))\n)\n\n# df_eda.createOrReplaceTempView(\"df_eda\")\ncategorical_cols = [\n    \"COMPANY_IS_STAFFING\", \"IS_INTERNSHIP\"\n]\n\nfor colname in categorical_cols:\n    print(f\"\\n---- {colname} ----\")\n    df_eda.select(colname).distinct().show(10, truncate=False)\n\n\n---- COMPANY_IS_STAFFING ----\n\n\n[Stage 19:&gt;                                                         (0 + 1) / 1]                                                                                \n\n\n+-------------------+\n|COMPANY_IS_STAFFING|\n+-------------------+\n|true               |\n|false              |\n+-------------------+\n\n\n---- IS_INTERNSHIP ----\n\n\n[Stage 22:&gt;                                                         (0 + 1) / 1]\n\n\n+-------------+\n|IS_INTERNSHIP|\n+-------------+\n|true         |\n|false        |\n+-------------+\n\n\n\n                                                                                \n\n\n\nimport pandas as pd\n\n# sample subset of data only 1% of the data\ndf_sample = df_eda.sample(fraction=0.01, seed=42).toPandas()\n\n#print(df_eda.count())  #72498\n#print(len(df_sample))  #790\n\n# create new DataFrame where each cell missing (True) or not (False)\nmissing_mask = df_sample.isnull()\n\n# Melt into long-form  | 4 columns: index, column, is_missing\nmissing_long = (\n    missing_mask.reset_index()\n    .melt(id_vars=\"index\", var_name=\"column\", value_name=\"is_missing\")\n)\n\n# Convert boolean to int\nmissing_long[\"is_missing\"] = missing_long[\"is_missing\"].astype(int)\n\nprint(missing_long)\n\n# Plot heatmap\nmissing_long.hvplot.heatmap(\n    x=\"column\", y=\"index\", C=\"is_missing\",\n    cmap=\"Reds\", colorbar=False,\n    width=900, height=700,\n    title=\"Heatmap of Missing Values (Sample)\"\n).opts(xrotation=45)\n\n[Stage 25:&gt;                                                         (0 + 1) / 1]                                                                                \n\n\n      index              column  is_missing\n0         0              SALARY           1\n1         1              SALARY           0\n2         2              SALARY           1\n3         3              SALARY           1\n4         4              SALARY           1\n...     ...                 ...         ...\n8685    785  MAX_EDULEVELS_NAME           0\n8686    786  MAX_EDULEVELS_NAME           0\n8687    787  MAX_EDULEVELS_NAME           1\n8688    788  MAX_EDULEVELS_NAME           1\n8689    789  MAX_EDULEVELS_NAME           1\n\n[8690 rows x 3 columns]\n\n\n\n\n\n\n  \n\n\n\n\n\nfrom pyspark.sql.functions import countDistinct\n\n#show number of unique values per column\ndf_eda.select([\n    countDistinct(c).alias(c + \"_nunique\")\n    for c in df_eda.columns\n]).show(truncate=False)\n\n[Stage 26:&gt;                                                         (0 + 1) / 1]\n\n\n+--------------+----------------------------+----------------------------+----------------+---------------------------+---------------------+------------------+------------------------+----------------------------+--------------------------+--------------------------+\n|SALARY_nunique|MIN_YEARS_EXPERIENCE_nunique|MAX_YEARS_EXPERIENCE_nunique|DURATION_nunique|COMPANY_IS_STAFFING_nunique|IS_INTERNSHIP_nunique|STATE_NAME_nunique|REMOTE_TYPE_NAME_nunique|EMPLOYMENT_TYPE_NAME_nunique|MIN_EDULEVELS_NAME_nunique|MAX_EDULEVELS_NAME_nunique|\n+--------------+----------------------------+----------------------------+----------------+---------------------------+---------------------+------------------+------------------------+----------------------------+--------------------------+--------------------------+\n|6052          |16                          |15                          |60              |2                          |2                    |51                |4                       |3                           |6                         |4                         |\n+--------------+----------------------------+----------------------------+----------------+---------------------------+---------------------+------------------+------------------------+----------------------------+--------------------------+--------------------------+\n\n\n\n                                                                                \n\n\n\ncategorical_cols = [\n    \"STATE_NAME\", \"REMOTE_TYPE_NAME\", \"EMPLOYMENT_TYPE_NAME\",\n    \"MIN_EDULEVELS_NAME\", \"COMPANY_IS_STAFFING\", \"IS_INTERNSHIP\"\n]\n\nfor colname in categorical_cols:\n    print(f\"\\n---- {colname} ----\")\n    df_eda.select(colname).distinct().show(10, truncate=False)\n\n\n---- STATE_NAME ----\n\n\n[Stage 32:&gt;                                                         (0 + 1) / 1]                                                                                \n\n\n+------------+\n|STATE_NAME  |\n+------------+\n|Utah        |\n|Hawaii      |\n|Minnesota   |\n|Ohio        |\n|Arkansas    |\n|Oregon      |\n|Texas       |\n|North Dakota|\n|Pennsylvania|\n|Connecticut |\n+------------+\nonly showing top 10 rows\n\n---- REMOTE_TYPE_NAME ----\n\n\n[Stage 35:&gt;                                                         (0 + 1) / 1]                                                                                \n\n\n+----------------+\n|REMOTE_TYPE_NAME|\n+----------------+\n|Remote          |\n|On-Premise      |\n|Hybrid          |\n|Undefined       |\n+----------------+\n\n\n---- EMPLOYMENT_TYPE_NAME ----\n\n\n[Stage 38:&gt;                                                         (0 + 1) / 1]                                                                                \n\n\n+--------------------+\n|EMPLOYMENT_TYPE_NAME|\n+--------------------+\n|Flexible            |\n|Fulltime            |\n|Parttime            |\n+--------------------+\n\n\n---- MIN_EDULEVELS_NAME ----\n\n\n[Stage 41:&gt;                                                         (0 + 1) / 1]                                                                                \n\n\n+----------------------------+\n|MIN_EDULEVELS_NAME          |\n+----------------------------+\n|Bachelor's degree           |\n|Ph.D. or professional degree|\n|High school or GED          |\n|Master's degree             |\n|No Education Listed         |\n|Associate degree            |\n|NULL                        |\n+----------------------------+\n\n\n---- COMPANY_IS_STAFFING ----\n\n\n[Stage 44:&gt;                                                         (0 + 1) / 1]                                                                                \n\n\n+-------------------+\n|COMPANY_IS_STAFFING|\n+-------------------+\n|true               |\n|false              |\n+-------------------+\n\n\n---- IS_INTERNSHIP ----\n\n\n[Stage 47:&gt;                                                         (0 + 1) / 1]\n\n\n+-------------+\n|IS_INTERNSHIP|\n+-------------+\n|true         |\n|false        |\n+-------------+\n\n\n\n                                                                                \n\n\n\n# Calculate median of the Duration Column\n\nmedian_duration = df_eda.approxQuantile(\"DURATION\", [0.5], 0.01)[0]\n\n# Check for missing values in Duration column and replace null with median\n\ndf_eda = df_eda.withColumn(\n    \"DURATION\",\n    when(col(\"DURATION\").isNull(), median_duration)\n    .otherwise(col(\"DURATION\"))\n) # Assuming median duration is 30 days\n\n[Stage 50:&gt;                                                         (0 + 1) / 1]                                                                                \n\n\n\nimport pandas as pd\n\n# sample subset of data\ndf_sample = df_eda.sample(fraction=0.10, seed=42).toPandas()\n\n# Boolean mask (True if missing)\nmissing_mask = df_sample.isnull()\n\n# Melt into long-form\nmissing_long = (\n    missing_mask.reset_index()\n    .melt(id_vars=\"index\", var_name=\"column\", value_name=\"is_missing\")\n)\n\n# Convert boolean to int\nmissing_long[\"is_missing\"] = missing_long[\"is_missing\"].astype(int)\n\n# Plot heatmap\nmissing_long.hvplot.heatmap(\n    x=\"column\", y=\"index\", C=\"is_missing\",\n    cmap=\"Reds\", colorbar=False,\n    width=900, height=700,\n    title=\"Heatmap of Missing Values (Sample)\"\n).opts(xrotation=45)\n\n[Stage 51:&gt;                                                         (0 + 1) / 1]                                                                                \n\n\n\n\n\n\n  \n\n\n\n\n\ndf_eda.show(5, truncate=False)\n\n+------+--------------------+--------------------+--------+-------------------+-------------+----------+----------------+--------------------+-------------------+------------------+\n|SALARY|MIN_YEARS_EXPERIENCE|MAX_YEARS_EXPERIENCE|DURATION|COMPANY_IS_STAFFING|IS_INTERNSHIP|STATE_NAME|REMOTE_TYPE_NAME|EMPLOYMENT_TYPE_NAME|MIN_EDULEVELS_NAME |MAX_EDULEVELS_NAME|\n+------+--------------------+--------------------+--------+-------------------+-------------+----------+----------------+--------------------+-------------------+------------------+\n|NULL  |2                   |2                   |6.0     |false              |false        |Arkansas  |Undefined       |Fulltime            |Bachelor's degree  |NULL              |\n|NULL  |3                   |3                   |18.0    |true               |false        |Maine     |Remote          |Fulltime            |No Education Listed|NULL              |\n|NULL  |5                   |NULL                |35.0    |false              |false        |Texas     |Undefined       |Fulltime            |Bachelor's degree  |NULL              |\n|NULL  |3                   |NULL                |48.0    |false              |false        |Arizona   |Undefined       |Fulltime            |No Education Listed|NULL              |\n|92500 |NULL                |NULL                |15.0    |false              |false        |California|Undefined       |Flexible            |No Education Listed|NULL              |\n+------+--------------------+--------------------+--------+-------------------+-------------+----------+----------------+--------------------+-------------------+------------------+\nonly showing top 5 rows\n\n\n\n# Drop rows with NA values in relevant columns\ndf_feature_engg = df_eda.dropna(subset=[\n    \"SALARY\", \"MIN_YEARS_EXPERIENCE\", \"MAX_YEARS_EXPERIENCE\",\"STATE_NAME\",\n     \"EMPLOYMENT_TYPE_NAME\", \"REMOTE_TYPE_NAME\",\"MIN_EDULEVELS_NAME\",\n    \"DURATION\", \"IS_INTERNSHIP\", \"COMPANY_IS_STAFFING\"\n])\n\n# Categorical columns\ncategorical_cols = [\"STATE_NAME\",\"MIN_EDULEVELS_NAME\",\"EMPLOYMENT_TYPE_NAME\", \"REMOTE_TYPE_NAME\"]\n\n# Index and One-Hot Encode\nindexers = [StringIndexer(inputCol=col, outputCol=f\"{col}_idx\", handleInvalid='skip') for col in categorical_cols]\nencoders = [OneHotEncoder(inputCol=f\"{col}_idx\", outputCol=f\"{col}_vec\") for col in categorical_cols]\n\npipeline = Pipeline(stages=indexers)\nindexed_df = pipeline.fit(df_feature_engg).transform(df_feature_engg)\nindexed_df.select(\"EMPLOYMENT_TYPE_NAME\",\"EMPLOYMENT_TYPE_NAME_idx\",\"REMOTE_TYPE_NAME\",\"REMOTE_TYPE_NAME_idx\").show()\n\npipeline = Pipeline(stages=indexers + encoders)\nencoded_df = pipeline.fit(df_feature_engg).transform(df_feature_engg)\nencoded_df.show()\n\n[Stage 53:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 59:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 65:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 71:&gt;                                                         (0 + 1) / 1]                                                                                \n\n\n+--------------------+------------------------+----------------+--------------------+\n|EMPLOYMENT_TYPE_NAME|EMPLOYMENT_TYPE_NAME_idx|REMOTE_TYPE_NAME|REMOTE_TYPE_NAME_idx|\n+--------------------+------------------------+----------------+--------------------+\n|            Fulltime|                     0.0|       Undefined|                 0.0|\n|            Fulltime|                     0.0|       Undefined|                 0.0|\n|            Fulltime|                     0.0|          Remote|                 1.0|\n|            Fulltime|                     0.0|       Undefined|                 0.0|\n|            Fulltime|                     0.0|          Remote|                 1.0|\n|            Fulltime|                     0.0|       Undefined|                 0.0|\n|            Fulltime|                     0.0|          Remote|                 1.0|\n|            Fulltime|                     0.0|          Remote|                 1.0|\n|            Fulltime|                     0.0|       Undefined|                 0.0|\n|            Fulltime|                     0.0|       Undefined|                 0.0|\n|            Fulltime|                     0.0|       Undefined|                 0.0|\n|            Fulltime|                     0.0|       Undefined|                 0.0|\n|            Fulltime|                     0.0|      On-Premise|                 3.0|\n|            Fulltime|                     0.0|       Undefined|                 0.0|\n|            Fulltime|                     0.0|       Undefined|                 0.0|\n|            Fulltime|                     0.0|       Undefined|                 0.0|\n|            Fulltime|                     0.0|          Remote|                 1.0|\n|            Flexible|                     2.0|       Undefined|                 0.0|\n|            Fulltime|                     0.0|       Undefined|                 0.0|\n|            Fulltime|                     0.0|       Undefined|                 0.0|\n+--------------------+------------------------+----------------+--------------------+\nonly showing top 20 rows\n\n\n[Stage 78:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 84:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 90:&gt;                                                         (0 + 1) / 1]                                                                                [Stage 96:&gt;                                                         (0 + 1) / 1]                                                                                \n\n\n+------+--------------------+--------------------+--------+-------------------+-------------+--------------+----------------+--------------------+------------------+--------------------+--------------+----------------------+------------------------+--------------------+---------------+----------------------+------------------------+--------------------+\n|SALARY|MIN_YEARS_EXPERIENCE|MAX_YEARS_EXPERIENCE|DURATION|COMPANY_IS_STAFFING|IS_INTERNSHIP|    STATE_NAME|REMOTE_TYPE_NAME|EMPLOYMENT_TYPE_NAME|MIN_EDULEVELS_NAME|  MAX_EDULEVELS_NAME|STATE_NAME_idx|MIN_EDULEVELS_NAME_idx|EMPLOYMENT_TYPE_NAME_idx|REMOTE_TYPE_NAME_idx| STATE_NAME_vec|MIN_EDULEVELS_NAME_vec|EMPLOYMENT_TYPE_NAME_vec|REMOTE_TYPE_NAME_vec|\n+------+--------------------+--------------------+--------+-------------------+-------------+--------------+----------------+--------------------+------------------+--------------------+--------------+----------------------+------------------------+--------------------+---------------+----------------------+------------------------+--------------------+\n| 92962|                   2|                   2|    18.0|              false|        false|      New York|       Undefined|            Fulltime| Bachelor's degree|     Master's degree|           1.0|                   0.0|                     0.0|                 0.0| (50,[1],[1.0])|         (5,[0],[1.0])|           (2,[0],[1.0])|       (3,[0],[1.0])|\n| 75026|                   2|                   2|    18.0|               true|        false|   Mississippi|       Undefined|            Fulltime| Bachelor's degree|                NULL|          21.0|                   0.0|                     0.0|                 0.0|(50,[21],[1.0])|         (5,[0],[1.0])|           (2,[0],[1.0])|       (3,[0],[1.0])|\n| 60923|                   1|                   1|    18.0|              false|        false|      New York|          Remote|            Fulltime| Bachelor's degree|                NULL|           1.0|                   0.0|                     0.0|                 1.0| (50,[1],[1.0])|         (5,[0],[1.0])|           (2,[0],[1.0])|       (3,[1],[1.0])|\n|131100|                   2|                   2|    11.0|              false|        false|       Arizona|       Undefined|            Fulltime| Bachelor's degree|                NULL|          15.0|                   0.0|                     0.0|                 0.0|(50,[15],[1.0])|         (5,[0],[1.0])|           (2,[0],[1.0])|       (3,[0],[1.0])|\n|136950|                   3|                   3|    18.0|              false|        false|         Maine|          Remote|            Fulltime| Bachelor's degree|Ph.D. or professi...|          40.0|                   0.0|                     0.0|                 1.0|(50,[40],[1.0])|         (5,[0],[1.0])|           (2,[0],[1.0])|       (3,[1],[1.0])|\n|122500|                   5|                   5|    18.0|              false|        false|    California|       Undefined|            Fulltime| Bachelor's degree|                NULL|           0.0|                   0.0|                     0.0|                 0.0| (50,[0],[1.0])|         (5,[0],[1.0])|           (2,[0],[1.0])|       (3,[0],[1.0])|\n|136950|                   3|                   3|    28.0|              false|        false|     Minnesota|          Remote|            Fulltime| Bachelor's degree|Ph.D. or professi...|          26.0|                   0.0|                     0.0|                 1.0|(50,[26],[1.0])|         (5,[0],[1.0])|           (2,[0],[1.0])|       (3,[1],[1.0])|\n|136950|                   3|                   3|    28.0|              false|        false|       Georgia|          Remote|            Fulltime| Bachelor's degree|Ph.D. or professi...|          13.0|                   0.0|                     0.0|                 1.0|(50,[13],[1.0])|         (5,[0],[1.0])|           (2,[0],[1.0])|       (3,[1],[1.0])|\n| 55120|                   2|                   2|    18.0|              false|        false|      Virginia|       Undefined|            Fulltime| Bachelor's degree|                NULL|           5.0|                   0.0|                     0.0|                 0.0| (50,[5],[1.0])|         (5,[0],[1.0])|           (2,[0],[1.0])|       (3,[0],[1.0])|\n|104000|                   3|                   3|     8.0|              false|        false|         Texas|       Undefined|            Fulltime| Bachelor's degree|                NULL|           2.0|                   0.0|                     0.0|                 0.0| (50,[2],[1.0])|         (5,[0],[1.0])|           (2,[0],[1.0])|       (3,[0],[1.0])|\n|145319|                   4|                   4|    18.0|              false|        false|          Ohio|       Undefined|            Fulltime| Bachelor's degree|     Master's degree|          10.0|                   0.0|                     0.0|                 0.0|(50,[10],[1.0])|         (5,[0],[1.0])|           (2,[0],[1.0])|       (3,[0],[1.0])|\n| 80000|                   3|                   3|    37.0|              false|        false|      Oklahoma|       Undefined|            Fulltime| Bachelor's degree|                NULL|          43.0|                   0.0|                     0.0|                 0.0|(50,[43],[1.0])|         (5,[0],[1.0])|           (2,[0],[1.0])|       (3,[0],[1.0])|\n|102500|                   3|                   3|    28.0|              false|        false|South Carolina|      On-Premise|            Fulltime| Bachelor's degree|                NULL|          27.0|                   0.0|                     0.0|                 3.0|(50,[27],[1.0])|         (5,[0],[1.0])|           (2,[0],[1.0])|           (3,[],[])|\n| 86117|                   2|                   2|    14.0|              false|        false|North Carolina|       Undefined|            Fulltime| Bachelor's degree|                NULL|          12.0|                   0.0|                     0.0|                 0.0|(50,[12],[1.0])|         (5,[0],[1.0])|           (2,[0],[1.0])|       (3,[0],[1.0])|\n| 72800|                   3|                   3|    15.0|               true|        false|      Missouri|       Undefined|            Fulltime|  Associate degree|                NULL|          17.0|                   3.0|                     0.0|                 0.0|(50,[17],[1.0])|         (5,[3],[1.0])|           (2,[0],[1.0])|       (3,[0],[1.0])|\n|162300|                   6|                   6|    18.0|              false|        false|      New York|       Undefined|            Fulltime| Bachelor's degree|     Master's degree|           1.0|                   0.0|                     0.0|                 0.0| (50,[1],[1.0])|         (5,[0],[1.0])|           (2,[0],[1.0])|       (3,[0],[1.0])|\n|121500|                   3|                   3|    18.0|              false|        false|    California|          Remote|            Fulltime| Bachelor's degree|     Master's degree|           0.0|                   0.0|                     0.0|                 1.0| (50,[0],[1.0])|         (5,[0],[1.0])|           (2,[0],[1.0])|       (3,[1],[1.0])|\n|117500|                   3|                   3|    14.0|              false|        false|      Arkansas|       Undefined|            Flexible| Bachelor's degree|     Master's degree|          20.0|                   0.0|                     2.0|                 0.0|(50,[20],[1.0])|         (5,[0],[1.0])|               (2,[],[])|       (3,[0],[1.0])|\n|102000|                   3|                   3|    25.0|              false|        false|      Michigan|       Undefined|            Fulltime| Bachelor's degree|                NULL|          14.0|                   0.0|                     0.0|                 0.0|(50,[14],[1.0])|         (5,[0],[1.0])|           (2,[0],[1.0])|       (3,[0],[1.0])|\n|142300|                   6|                   6|    18.0|              false|        false|       Florida|       Undefined|            Fulltime| Bachelor's degree|     Master's degree|           3.0|                   0.0|                     0.0|                 0.0| (50,[3],[1.0])|         (5,[0],[1.0])|           (2,[0],[1.0])|       (3,[0],[1.0])|\n+------+--------------------+--------------------+--------+-------------------+-------------+--------------+----------------+--------------------+------------------+--------------------+--------------+----------------------+------------------------+--------------------+---------------+----------------------+------------------------+--------------------+\nonly showing top 20 rows\n\n\n\n# Assemble base features (for GLR and Random Forest)\nassembler = VectorAssembler(\n    inputCols=[\n        \"MIN_YEARS_EXPERIENCE\", \"DURATION\",\n        \"IS_INTERNSHIP\", \"COMPANY_IS_STAFFING\"\n    ] + [f\"{col}_vec\" for col in categorical_cols],\n    outputCol=\"features\"\n)\n\n# Build pipeline and transform\npipeline = Pipeline(stages=indexers + encoders + [assembler])\ndata = pipeline.fit(df_feature_engg).transform(df_feature_engg)\n\ndata.show(5, truncate=False)\n\n# Create squared term for Polynomial Regression\ndata = data.withColumn(\"MIN_YEARS_EXPERIENCE_SQ\", pow(col(\"MIN_YEARS_EXPERIENCE\"), 2))\n\n# Assemble polynomial features\nassembler_poly = VectorAssembler(\n    inputCols=[\n        \"MIN_YEARS_EXPERIENCE\", \"MIN_YEARS_EXPERIENCE_SQ\",\n        \"DURATION\", \"IS_INTERNSHIP\", \"COMPANY_IS_STAFFING\"\n    ] + [f\"{col}_vec\" for col in categorical_cols],\n    outputCol=\"features_poly\"\n    \n)\n\ndata=assembler_poly.transform(data)\n\n#show final structure\ndata.select(\"SALARY\", \"features\", \"features_poly\").show(5, truncate=False)\n\n[Stage 103:&gt;                                                        (0 + 1) / 1]                                                                                [Stage 109:&gt;                                                        (0 + 1) / 1]                                                                                [Stage 115:&gt;                                                        (0 + 1) / 1]                                                                                [Stage 121:&gt;                                                        (0 + 1) / 1]                                                                                \n\n\n+------+--------------------+--------------------+--------+-------------------+-------------+-----------+----------------+--------------------+------------------+----------------------------+--------------+----------------------+------------------------+--------------------+---------------+----------------------+------------------------+--------------------+-------------------------------------------------------+\n|SALARY|MIN_YEARS_EXPERIENCE|MAX_YEARS_EXPERIENCE|DURATION|COMPANY_IS_STAFFING|IS_INTERNSHIP|STATE_NAME |REMOTE_TYPE_NAME|EMPLOYMENT_TYPE_NAME|MIN_EDULEVELS_NAME|MAX_EDULEVELS_NAME          |STATE_NAME_idx|MIN_EDULEVELS_NAME_idx|EMPLOYMENT_TYPE_NAME_idx|REMOTE_TYPE_NAME_idx|STATE_NAME_vec |MIN_EDULEVELS_NAME_vec|EMPLOYMENT_TYPE_NAME_vec|REMOTE_TYPE_NAME_vec|features                                               |\n+------+--------------------+--------------------+--------+-------------------+-------------+-----------+----------------+--------------------+------------------+----------------------------+--------------+----------------------+------------------------+--------------------+---------------+----------------------+------------------------+--------------------+-------------------------------------------------------+\n|92962 |2                   |2                   |18.0    |false              |false        |New York   |Undefined       |Fulltime            |Bachelor's degree |Master's degree             |1.0           |0.0                   |0.0                     |0.0                 |(50,[1],[1.0]) |(5,[0],[1.0])         |(2,[0],[1.0])           |(3,[0],[1.0])       |(64,[0,1,5,54,59,61],[2.0,18.0,1.0,1.0,1.0,1.0])       |\n|75026 |2                   |2                   |18.0    |true               |false        |Mississippi|Undefined       |Fulltime            |Bachelor's degree |NULL                        |21.0          |0.0                   |0.0                     |0.0                 |(50,[21],[1.0])|(5,[0],[1.0])         |(2,[0],[1.0])           |(3,[0],[1.0])       |(64,[0,1,3,25,54,59,61],[2.0,18.0,1.0,1.0,1.0,1.0,1.0])|\n|60923 |1                   |1                   |18.0    |false              |false        |New York   |Remote          |Fulltime            |Bachelor's degree |NULL                        |1.0           |0.0                   |0.0                     |1.0                 |(50,[1],[1.0]) |(5,[0],[1.0])         |(2,[0],[1.0])           |(3,[1],[1.0])       |(64,[0,1,5,54,59,62],[1.0,18.0,1.0,1.0,1.0,1.0])       |\n|131100|2                   |2                   |11.0    |false              |false        |Arizona    |Undefined       |Fulltime            |Bachelor's degree |NULL                        |15.0          |0.0                   |0.0                     |0.0                 |(50,[15],[1.0])|(5,[0],[1.0])         |(2,[0],[1.0])           |(3,[0],[1.0])       |(64,[0,1,19,54,59,61],[2.0,11.0,1.0,1.0,1.0,1.0])      |\n|136950|3                   |3                   |18.0    |false              |false        |Maine      |Remote          |Fulltime            |Bachelor's degree |Ph.D. or professional degree|40.0          |0.0                   |0.0                     |1.0                 |(50,[40],[1.0])|(5,[0],[1.0])         |(2,[0],[1.0])           |(3,[1],[1.0])       |(64,[0,1,44,54,59,62],[3.0,18.0,1.0,1.0,1.0,1.0])      |\n+------+--------------------+--------------------+--------+-------------------+-------------+-----------+----------------+--------------------+------------------+----------------------------+--------------+----------------------+------------------------+--------------------+---------------+----------------------+------------------------+--------------------+-------------------------------------------------------+\nonly showing top 5 rows\n+------+-------------------------------------------------------+-------------------------------------------------------------+\n|SALARY|features                                               |features_poly                                                |\n+------+-------------------------------------------------------+-------------------------------------------------------------+\n|92962 |(64,[0,1,5,54,59,61],[2.0,18.0,1.0,1.0,1.0,1.0])       |(65,[0,1,2,6,55,60,62],[2.0,4.0,18.0,1.0,1.0,1.0,1.0])       |\n|75026 |(64,[0,1,3,25,54,59,61],[2.0,18.0,1.0,1.0,1.0,1.0,1.0])|(65,[0,1,2,4,26,55,60,62],[2.0,4.0,18.0,1.0,1.0,1.0,1.0,1.0])|\n|60923 |(64,[0,1,5,54,59,62],[1.0,18.0,1.0,1.0,1.0,1.0])       |(65,[0,1,2,6,55,60,63],[1.0,1.0,18.0,1.0,1.0,1.0,1.0])       |\n|131100|(64,[0,1,19,54,59,61],[2.0,11.0,1.0,1.0,1.0,1.0])      |(65,[0,1,2,20,55,60,62],[2.0,4.0,11.0,1.0,1.0,1.0,1.0])      |\n|136950|(64,[0,1,44,54,59,62],[3.0,18.0,1.0,1.0,1.0,1.0])      |(65,[0,1,2,45,55,60,63],[3.0,9.0,18.0,1.0,1.0,1.0,1.0])      |\n+------+-------------------------------------------------------+-------------------------------------------------------------+\nonly showing top 5 rows\n\n\n\n\n[Stage 129:&gt;                                                        (0 + 1) / 1]                                                                                \n\n\n(3756, 22)\n\n\n[Stage 132:&gt;                                                        (0 + 1) / 1]                                                                                \n\n\n(3060, 22)\n\n\n[Stage 135:&gt;                                                        (0 + 1) / 1]\n\n\n(696, 22)\n\n\n                                                                                \n\n\n\nfrom pyspark.ml.regression import LinearRegression\n\n# Initialize  Regression model\n# Basic Linear Regression model\nmr = LinearRegression(featuresCol=\"features\", labelCol=\"SALARY\")\n\n# Polynomial Regression using squared term features\n#mr = LinearRegression(featuresCol=\"features_poly\", labelCol=\"SALARY\")\n\n# Generalized Linear Regression (supports distributions like Gaussian, Poisson)\n    # mr = GeneralizedLinearRegression(\n    #     featuresCol=\"features\", labelCol=\"SALARY\",\n    #     family=\"gaussian\", link=\"identity\"\n    # )\n\n\n# Train the model\nmr_model = mr.fit(regression_train)\n\n# Evaluate on test data\ntest_results = mr_model.evaluate(regression_test)\n\n# Print metrics\nprint(\"RMSE:\", test_results.rootMeanSquaredError)\nprint(\"R2:\", test_results.r2)\n\n25/10/07 07:32:31 WARN Instrumentation: [15abac60] regParam is zero, which might cause numerical instability and overfitting.\n[Stage 138:&gt;                                                        (0 + 1) / 1]25/10/07 07:32:36 WARN InstanceBuilder: Failed to load implementation from:dev.ludovic.netlib.blas.JNIBLAS\n                                                                                25/10/07 07:32:36 WARN InstanceBuilder: Failed to load implementation from:dev.ludovic.netlib.lapack.JNILAPACK\n[Stage 139:&gt;                                                        (0 + 1) / 1]                                                                                [Stage 140:&gt;                                                        (0 + 1) / 1]\n\n\nRMSE: 29114.307979774672\nR2: 0.34792446541830324\n\n\n                                                                                \n\n\n\ncoeffs = mr_model.coefficients\nintercept = mr_model.intercept\n\nprint(\"Intercept:\", intercept)\nprint(\"Coefficients:\", coeffs)\n\nIntercept: 131328.3004796009\nCoefficients: [8523.062910159928,-98.93546907813675,2782.413073078266,-1078.1337256635686,12347.650329505026,12099.991428639481,5508.201281626465,4103.394476179377,6827.789398867635,1859.9349418510367,7751.353854768509,9315.672167780182,-755.6703653785958,9973.18649877864,1314.7076955620487,-1299.0660250961937,2093.9361992914087,7193.052647920884,-5124.810223960465,4945.904023459982,-293.75547075283794,434.7029433494427,4697.278843397262,7021.701277240336,7659.209522281594,-11920.218306321509,-2098.935017913266,28.958169601522584,10422.439688057706,-1534.9827239260164,3298.1875476982027,2561.1538943029723,8352.834248147985,-3844.4745256701326,-1105.821356233869,1840.7175686222201,487.1782311291216,5803.378236307139,139.85835159896615,2939.1994362592077,-3041.9102995939397,10591.372903022557,-577.2862695106961,-3619.269866311597,5432.8888205860085,311.95208019053894,3281.416667399771,-520.5179852949578,3209.602981992066,-3999.8839871360237,-3502.2852404853415,8178.297251076545,1268.381407942167,710.5884205836893,-54961.00350028223,-49607.85277992999,-84497.42795385023,-79343.56469541852,-40206.932513201114,-17034.987287641532,-20945.521186969952,13599.615064274507,19866.842315893853,8671.816402025408]"
  }
]